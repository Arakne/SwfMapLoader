/*
 * This file is part of Swf Map Loader.
 *
 * Swf Map Loader is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Swf Map Loader is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public License
 * along with Swf Map Loader.  If not, see <https://www.gnu.org/licenses/>.
 *
 * Copyright (c) 2020-2020 Vincent Quatrevieux
 */

package fr.arakne.swfmaploader.cache;

import fr.arakne.swfmaploader.swf.SwfMapStructure;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;

import java.io.File;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;

import static org.junit.jupiter.api.Assertions.*;

class SqlMapStructureCacheTest {
    private Connection connection;
    private SqlMapStructureCache cache;

    @BeforeEach
    void setUp() throws SQLException {
        connection = DriverManager.getConnection("jdbc:sqlite::memory:");
        cache = new SqlMapStructureCache(connection);
    }

    @Test
    void initializeDatabase() throws SQLException {
        assertTrue(connection.createStatement().executeQuery("SELECT `name` FROM  `sqlite_master` WHERE `type` = 'table' AND `name` = 'MAP_CACHE'").next());
        assertTrue(connection.createStatement().executeQuery("SELECT `name` FROM  `sqlite_master` WHERE `type` = 'table' AND `name` = 'SCHEMA_VERSION'").next());
        assertTrue(connection.createStatement().executeQuery("SELECT `VERSION` FROM  `SCHEMA_VERSION` WHERE `VERSION` = 1").next());
    }

    @Test
    void retrieveNotFound() {
        assertFalse(cache.retrieve(404).isPresent());
    }

    @Test
    void storeAndRetrieve() {
        SwfMapStructure structure = new SwfMapStructure();

        structure.setId(41);
        structure.setWidth(15);
        structure.setHeight(17);
        structure.setBackgroundNum(71);
        structure.setAmbianceId(6);
        structure.setMusicId(115);
        structure.setOutdoor(true);
        structure.setCapabilities(0);
        structure.setMapData("HhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHxbfeaaadyH3bfeaaaaaHhaaeoIaaaHhaaeaaadyHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeqgaaaHhGaeaaaaaGhaaeoIaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHxbfeaaadyHhbfeaaadyHxG5eaaaaabhGaeaaaaaHhG7eaaaaabhGaeaaaaaHhaaeaaaaaHha7eaaadyHhWaeaaaaaHhGaeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHhbfeaaadyHNHfeoIaaaHxG5eaaaaaH3G7eoIaaaHxG7eoIaaabhaaeaaadyHha5eoIaaaHxG7eaaaaaHhGaeaaaaaHhaaeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhaaeaaaaaHhHfeaaaaaHxHfeaaaeBHxG5eoIaiFHNa7eaaadtbhGaeaaaaaH3a5eaaaaaGNa5eaaadtHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaGhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaaHhHfeaaaaaHNHfeaaaaaHxG5eaaaaabhGaeaaaaabhGaeaaaaaHNa5eoIadyHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaGhaaeaaaaaahaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaabhGaeaaaaaH3HfeaaaaaHxG5eoIaaabhGaeaaaaaG3a6eaaadtHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhaaeaaadyGhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaaHhaaeoIadtbhaaeaaaaaGxbfeaaadLHxG5eaaaaabhGaeaaaaaHxG7eaaaaaHhGaeaaaaaHhGaemHWaaHhGaeb4aaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHNbfeaaaaaHxa5eoIadtHNa7eaaadyHhGaeaaaaaHhWaeaaaaaHxyfeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaabhaaeaaaaaHxbfeaaaaaGxa5eaaadKHhGaeaaaaaHhGaeaaaaaHhyaeb4WaaHNafeaaafCGhaaeoIaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaabhaaeaaaaaHNbfeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHNqfeqgaaaHxGgebQaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeoIaaabhaaeaaaaabhbfeaaaaaHNbfeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaemHGaaH3yfeb0WaaHhGaeb5q4QGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeoIaaabxbfeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHhWaemHGaaHhGaeb4GaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaiFHhGaeaaaaaHhGaeaaaaaHhGaeaaa4QGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaa4QGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeoIaaabhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeb4WaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaH3GfebOGaaGxageaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeb5WaaHhWgeaaaaaGxagebQaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHNWgeaaaaaHxqgeqgaaaG3agebQaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaaHhWaeqgGaaHhWaem0aaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeb5WaaHNWgeaaaaaHNWgeaaaaaGNageaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaiFH3WfebLqaaH3WgeaaaaaHxWgeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaaaGhaaeaaaiQHhWaeb4WaaHhWfebLqaaHNWgeaaaaaHNW5ebPWaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHhaaeaaa4QHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaiFHhG9eaaaaaH3WfeaaaaaHNWfebLqaaH3Wfeb0qaaH3G5eaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeoIaaabhaaeaaaaaHhGaeaaa4QHhGaeaaaaaHhGaeaaaaaHhGaeaaaiFHhWaeaaaaaHhGaemHGaaHhGaeb5qaaHxWfeaaaaaHhWaeb4qaaH3G5eaaaaaGhaaeaaaaabh4aeaaaaabhaaeaaaaabhaaeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaGhaaeaaadKHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaemHGiFHhWaeb4GaaHhGaeaaaaaH3G5eaaaaaGhaaeaaaaabhaaeaaaaabhaaeoIaaaGNbfeaaaaaHhGaeaaaaaHhGaeaaaaaHhaaeaaadyHhG9eaaaaaHhGaeaaaaaHhWaeaaaaaHhaaeaaadpHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaH3G5eaaaaaGhaaeaaaaabhaaeaaaaaGxbfeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaiFHhG9eaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhG6eaaaaaGhaaeaaaaaG3bfeaaaaaHNa5eaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaiFHhWaeaaaaaHhWaeaaaaaHhWaeaaaaaHhGaeaaaiFH3G7eaaaaaHxG7eaaaaaG3ageaaaaaHNW5eqgaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhaaeaaadPHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaGNa7eaaadxHNGgeaaaaaHNW5ebOaaaHhaaeaaaaaHhGaeaaaeBHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaiFHhG9eaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhqaeqgaaaH3WgebQaaaHhWaeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaemHWaaHhGaemHaaaHhGaem0aaaHhWaeaaaaaHhGaeaaaaaHhWaeb0WaaHhWaeaaaaaHhaaeaaaaaHhGaeaaaeAHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeb5aaaHhqfeqgaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaeBHhWaeaaaaaHhWaeaaaaaHhGaeaaaiFHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeb4WaaH3afeaaaaaHhaaeb5qaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaa");

        cache.store(structure);

        SwfMapStructure cached = cache.retrieve(41).get();

        assertEquals(41, cached.id());
        assertEquals(15, cached.width());
        assertEquals(17, cached.height());
        assertEquals(71, cached.backgroundNum());
        assertEquals(6, cached.ambianceId());
        assertEquals(115, cached.musicId());
        assertTrue(cached.isOutdoor());
        assertEquals(0, cached.capabilities());
        assertEquals("HhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHxbfeaaadyH3bfeaaaaaHhaaeoIaaaHhaaeaaadyHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeqgaaaHhGaeaaaaaGhaaeoIaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHxbfeaaadyHhbfeaaadyHxG5eaaaaabhGaeaaaaaHhG7eaaaaabhGaeaaaaaHhaaeaaaaaHha7eaaadyHhWaeaaaaaHhGaeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHhbfeaaadyHNHfeoIaaaHxG5eaaaaaH3G7eoIaaaHxG7eoIaaabhaaeaaadyHha5eoIaaaHxG7eaaaaaHhGaeaaaaaHhaaeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhaaeaaaaaHhHfeaaaaaHxHfeaaaeBHxG5eoIaiFHNa7eaaadtbhGaeaaaaaH3a5eaaaaaGNa5eaaadtHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaGhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaaHhHfeaaaaaHNHfeaaaaaHxG5eaaaaabhGaeaaaaabhGaeaaaaaHNa5eoIadyHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaGhaaeaaaaaahaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaabhGaeaaaaaH3HfeaaaaaHxG5eoIaaabhGaeaaaaaG3a6eaaadtHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhaaeaaadyGhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaaHhaaeoIadtbhaaeaaaaaGxbfeaaadLHxG5eaaaaabhGaeaaaaaHxG7eaaaaaHhGaeaaaaaHhGaemHWaaHhGaeb4aaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHNbfeaaaaaHxa5eoIadtHNa7eaaadyHhGaeaaaaaHhWaeaaaaaHxyfeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaabhaaeaaaaaHxbfeaaaaaGxa5eaaadKHhGaeaaaaaHhGaeaaaaaHhyaeb4WaaHNafeaaafCGhaaeoIaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaabhaaeaaaaaHNbfeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHNqfeqgaaaHxGgebQaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeoIaaabhaaeaaaaabhbfeaaaaaHNbfeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaemHGaaH3yfeb0WaaHhGaeb5q4QGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeoIaaabxbfeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHhWaemHGaaHhGaeb4GaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaiFHhGaeaaaaaHhGaeaaaaaHhGaeaaa4QGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaa4QGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeoIaaabhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeb4WaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaH3GfebOGaaGxageaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeb5WaaHhWgeaaaaaGxagebQaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHNWgeaaaaaHxqgeqgaaaG3agebQaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaaHhWaeqgGaaHhWaem0aaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeb5WaaHNWgeaaaaaHNWgeaaaaaGNageaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaiFH3WfebLqaaH3WgeaaaaaHxWgeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaaaGhaaeaaaiQHhWaeb4WaaHhWfebLqaaHNWgeaaaaaHNW5ebPWaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHhaaeaaa4QHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaiFHhG9eaaaaaH3WfeaaaaaHNWfebLqaaH3Wfeb0qaaH3G5eaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeoIaaabhaaeaaaaaHhGaeaaa4QHhGaeaaaaaHhGaeaaaaaHhGaeaaaiFHhWaeaaaaaHhGaemHGaaHhGaeb5qaaHxWfeaaaaaHhWaeb4qaaH3G5eaaaaaGhaaeaaaaabh4aeaaaaabhaaeaaaaabhaaeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaGhaaeaaadKHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaemHGiFHhWaeb4GaaHhGaeaaaaaH3G5eaaaaaGhaaeaaaaabhaaeaaaaabhaaeoIaaaGNbfeaaaaaHhGaeaaaaaHhGaeaaaaaHhaaeaaadyHhG9eaaaaaHhGaeaaaaaHhWaeaaaaaHhaaeaaadpHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaH3G5eaaaaaGhaaeaaaaabhaaeaaaaaGxbfeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaiFHhG9eaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhG6eaaaaaGhaaeaaaaaG3bfeaaaaaHNa5eaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaiFHhWaeaaaaaHhWaeaaaaaHhWaeaaaaaHhGaeaaaiFH3G7eaaaaaHxG7eaaaaaG3ageaaaaaHNW5eqgaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhaaeaaadPHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaGNa7eaaadxHNGgeaaaaaHNW5ebOaaaHhaaeaaaaaHhGaeaaaeBHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaiFHhG9eaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhqaeqgaaaH3WgebQaaaHhWaeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaemHWaaHhGaemHaaaHhGaem0aaaHhWaeaaaaaHhGaeaaaaaHhWaeb0WaaHhWaeaaaaaHhaaeaaaaaHhGaeaaaeAHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeb5aaaHhqfeqgaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaeBHhWaeaaaaaHhWaeaaaaaHhGaeaaaiFHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeb4WaaH3afeaaaaaHhaaeb5qaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaa", cached.mapData());
    }

    @Test
    void storeUpdate() {
        SwfMapStructure structure = new SwfMapStructure();

        structure.setId(41);
        structure.setWidth(15);
        structure.setHeight(17);
        structure.setBackgroundNum(71);
        structure.setAmbianceId(6);
        structure.setMusicId(115);
        structure.setOutdoor(true);
        structure.setCapabilities(0);
        structure.setMapData("HhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHxbfeaaadyH3bfeaaaaaHhaaeoIaaaHhaaeaaadyHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeqgaaaHhGaeaaaaaGhaaeoIaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHxbfeaaadyHhbfeaaadyHxG5eaaaaabhGaeaaaaaHhG7eaaaaabhGaeaaaaaHhaaeaaaaaHha7eaaadyHhWaeaaaaaHhGaeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHhbfeaaadyHNHfeoIaaaHxG5eaaaaaH3G7eoIaaaHxG7eoIaaabhaaeaaadyHha5eoIaaaHxG7eaaaaaHhGaeaaaaaHhaaeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhaaeaaaaaHhHfeaaaaaHxHfeaaaeBHxG5eoIaiFHNa7eaaadtbhGaeaaaaaH3a5eaaaaaGNa5eaaadtHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaGhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaaHhHfeaaaaaHNHfeaaaaaHxG5eaaaaabhGaeaaaaabhGaeaaaaaHNa5eoIadyHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaGhaaeaaaaaahaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaabhGaeaaaaaH3HfeaaaaaHxG5eoIaaabhGaeaaaaaG3a6eaaadtHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhaaeaaadyGhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaaHhaaeoIadtbhaaeaaaaaGxbfeaaadLHxG5eaaaaabhGaeaaaaaHxG7eaaaaaHhGaeaaaaaHhGaemHWaaHhGaeb4aaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHNbfeaaaaaHxa5eoIadtHNa7eaaadyHhGaeaaaaaHhWaeaaaaaHxyfeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaabhaaeaaaaaHxbfeaaaaaGxa5eaaadKHhGaeaaaaaHhGaeaaaaaHhyaeb4WaaHNafeaaafCGhaaeoIaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaabhaaeaaaaaHNbfeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHNqfeqgaaaHxGgebQaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeoIaaabhaaeaaaaabhbfeaaaaaHNbfeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaemHGaaH3yfeb0WaaHhGaeb5q4QGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeoIaaabxbfeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHhWaemHGaaHhGaeb4GaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaiFHhGaeaaaaaHhGaeaaaaaHhGaeaaa4QGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaa4QGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeoIaaabhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeb4WaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaH3GfebOGaaGxageaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeb5WaaHhWgeaaaaaGxagebQaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHNWgeaaaaaHxqgeqgaaaG3agebQaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaaHhWaeqgGaaHhWaem0aaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeb5WaaHNWgeaaaaaHNWgeaaaaaGNageaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaiFH3WfebLqaaH3WgeaaaaaHxWgeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaaaGhaaeaaaiQHhWaeb4WaaHhWfebLqaaHNWgeaaaaaHNW5ebPWaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHhaaeaaa4QHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaiFHhG9eaaaaaH3WfeaaaaaHNWfebLqaaH3Wfeb0qaaH3G5eaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeoIaaabhaaeaaaaaHhGaeaaa4QHhGaeaaaaaHhGaeaaaaaHhGaeaaaiFHhWaeaaaaaHhGaemHGaaHhGaeb5qaaHxWfeaaaaaHhWaeb4qaaH3G5eaaaaaGhaaeaaaaabh4aeaaaaabhaaeaaaaabhaaeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaGhaaeaaadKHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaemHGiFHhWaeb4GaaHhGaeaaaaaH3G5eaaaaaGhaaeaaaaabhaaeaaaaabhaaeoIaaaGNbfeaaaaaHhGaeaaaaaHhGaeaaaaaHhaaeaaadyHhG9eaaaaaHhGaeaaaaaHhWaeaaaaaHhaaeaaadpHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaH3G5eaaaaaGhaaeaaaaabhaaeaaaaaGxbfeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaiFHhG9eaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhG6eaaaaaGhaaeaaaaaG3bfeaaaaaHNa5eaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaiFHhWaeaaaaaHhWaeaaaaaHhWaeaaaaaHhGaeaaaiFH3G7eaaaaaHxG7eaaaaaG3ageaaaaaHNW5eqgaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhaaeaaadPHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaGNa7eaaadxHNGgeaaaaaHNW5ebOaaaHhaaeaaaaaHhGaeaaaeBHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaiFHhG9eaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhqaeqgaaaH3WgebQaaaHhWaeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaemHWaaHhGaemHaaaHhGaem0aaaHhWaeaaaaaHhGaeaaaaaHhWaeb0WaaHhWaeaaaaaHhaaeaaaaaHhGaeaaaeAHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeb5aaaHhqfeqgaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaeBHhWaeaaaaaHhWaeaaaaaHhGaeaaaiFHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeb4WaaH3afeaaaaaHhaaeb5qaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaa");

        cache.store(structure);
        structure.setAmbianceId(8);
        cache.store(structure);

        SwfMapStructure cached = cache.retrieve(41).get();

        assertEquals(8, cached.ambianceId());
    }

    @Test
    void storeAndRetrieveOnOtherInstance() throws SQLException {
        SwfMapStructure structure = new SwfMapStructure();

        structure.setId(41);
        structure.setWidth(15);
        structure.setHeight(17);
        structure.setBackgroundNum(71);
        structure.setAmbianceId(6);
        structure.setMusicId(115);
        structure.setOutdoor(true);
        structure.setCapabilities(0);
        structure.setMapData("HhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHxbfeaaadyH3bfeaaaaaHhaaeoIaaaHhaaeaaadyHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeqgaaaHhGaeaaaaaGhaaeoIaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHxbfeaaadyHhbfeaaadyHxG5eaaaaabhGaeaaaaaHhG7eaaaaabhGaeaaaaaHhaaeaaaaaHha7eaaadyHhWaeaaaaaHhGaeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHhbfeaaadyHNHfeoIaaaHxG5eaaaaaH3G7eoIaaaHxG7eoIaaabhaaeaaadyHha5eoIaaaHxG7eaaaaaHhGaeaaaaaHhaaeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhaaeaaaaaHhHfeaaaaaHxHfeaaaeBHxG5eoIaiFHNa7eaaadtbhGaeaaaaaH3a5eaaaaaGNa5eaaadtHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaGhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaaHhHfeaaaaaHNHfeaaaaaHxG5eaaaaabhGaeaaaaabhGaeaaaaaHNa5eoIadyHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaGhaaeaaaaaahaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaabhGaeaaaaaH3HfeaaaaaHxG5eoIaaabhGaeaaaaaG3a6eaaadtHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhaaeaaadyGhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaaHhaaeoIadtbhaaeaaaaaGxbfeaaadLHxG5eaaaaabhGaeaaaaaHxG7eaaaaaHhGaeaaaaaHhGaemHWaaHhGaeb4aaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHNbfeaaaaaHxa5eoIadtHNa7eaaadyHhGaeaaaaaHhWaeaaaaaHxyfeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaabhaaeaaaaaHxbfeaaaaaGxa5eaaadKHhGaeaaaaaHhGaeaaaaaHhyaeb4WaaHNafeaaafCGhaaeoIaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaabhaaeaaaaaHNbfeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHNqfeqgaaaHxGgebQaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeoIaaabhaaeaaaaabhbfeaaaaaHNbfeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaemHGaaH3yfeb0WaaHhGaeb5q4QGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeoIaaabxbfeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHhWaemHGaaHhGaeb4GaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaiFHhGaeaaaaaHhGaeaaaaaHhGaeaaa4QGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaa4QGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeoIaaabhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeb4WaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaH3GfebOGaaGxageaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeb5WaaHhWgeaaaaaGxagebQaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHNWgeaaaaaHxqgeqgaaaG3agebQaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaaHhWaeqgGaaHhWaem0aaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeb5WaaHNWgeaaaaaHNWgeaaaaaGNageaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaiFH3WfebLqaaH3WgeaaaaaHxWgeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaaaGhaaeaaaiQHhWaeb4WaaHhWfebLqaaHNWgeaaaaaHNW5ebPWaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHhaaeaaa4QHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaiFHhG9eaaaaaH3WfeaaaaaHNWfebLqaaH3Wfeb0qaaH3G5eaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeoIaaabhaaeaaaaaHhGaeaaa4QHhGaeaaaaaHhGaeaaaaaHhGaeaaaiFHhWaeaaaaaHhGaemHGaaHhGaeb5qaaHxWfeaaaaaHhWaeb4qaaH3G5eaaaaaGhaaeaaaaabh4aeaaaaabhaaeaaaaabhaaeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaGhaaeaaadKHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaemHGiFHhWaeb4GaaHhGaeaaaaaH3G5eaaaaaGhaaeaaaaabhaaeaaaaabhaaeoIaaaGNbfeaaaaaHhGaeaaaaaHhGaeaaaaaHhaaeaaadyHhG9eaaaaaHhGaeaaaaaHhWaeaaaaaHhaaeaaadpHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaH3G5eaaaaaGhaaeaaaaabhaaeaaaaaGxbfeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaiFHhG9eaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhG6eaaaaaGhaaeaaaaaG3bfeaaaaaHNa5eaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaiFHhWaeaaaaaHhWaeaaaaaHhWaeaaaaaHhGaeaaaiFH3G7eaaaaaHxG7eaaaaaG3ageaaaaaHNW5eqgaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhaaeaaadPHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaGNa7eaaadxHNGgeaaaaaHNW5ebOaaaHhaaeaaaaaHhGaeaaaeBHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaiFHhG9eaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhqaeqgaaaH3WgebQaaaHhWaeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaemHWaaHhGaemHaaaHhGaem0aaaHhWaeaaaaaHhGaeaaaaaHhWaeb0WaaHhWaeaaaaaHhaaeaaaaaHhGaeaaaeAHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeb5aaaHhqfeqgaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaeBHhWaeaaaaaHhWaeaaaaaHhGaeaaaiFHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeb4WaaH3afeaaaaaHhaaeb5qaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaa");

        cache.store(structure);

        SqlMapStructureCache newCache = new SqlMapStructureCache(connection);

        SwfMapStructure cached = newCache.retrieve(41).get();

        assertEquals(41, cached.id());
        assertEquals(15, cached.width());
        assertEquals(17, cached.height());
        assertEquals(71, cached.backgroundNum());
        assertEquals(6, cached.ambianceId());
        assertEquals(115, cached.musicId());
        assertTrue(cached.isOutdoor());
        assertEquals(0, cached.capabilities());
        assertEquals("HhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHxbfeaaadyH3bfeaaaaaHhaaeoIaaaHhaaeaaadyHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeqgaaaHhGaeaaaaaGhaaeoIaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHxbfeaaadyHhbfeaaadyHxG5eaaaaabhGaeaaaaaHhG7eaaaaabhGaeaaaaaHhaaeaaaaaHha7eaaadyHhWaeaaaaaHhGaeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHhbfeaaadyHNHfeoIaaaHxG5eaaaaaH3G7eoIaaaHxG7eoIaaabhaaeaaadyHha5eoIaaaHxG7eaaaaaHhGaeaaaaaHhaaeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhaaeaaaaaHhHfeaaaaaHxHfeaaaeBHxG5eoIaiFHNa7eaaadtbhGaeaaaaaH3a5eaaaaaGNa5eaaadtHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaGhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaaHhHfeaaaaaHNHfeaaaaaHxG5eaaaaabhGaeaaaaabhGaeaaaaaHNa5eoIadyHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaGhaaeaaaaaahaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaabhGaeaaaaaH3HfeaaaaaHxG5eoIaaabhGaeaaaaaG3a6eaaadtHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhaaeaaadyGhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaaHhaaeoIadtbhaaeaaaaaGxbfeaaadLHxG5eaaaaabhGaeaaaaaHxG7eaaaaaHhGaeaaaaaHhGaemHWaaHhGaeb4aaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHNbfeaaaaaHxa5eoIadtHNa7eaaadyHhGaeaaaaaHhWaeaaaaaHxyfeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaabhaaeaaaaaHxbfeaaaaaGxa5eaaadKHhGaeaaaaaHhGaeaaaaaHhyaeb4WaaHNafeaaafCGhaaeoIaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaabhaaeaaaaaHNbfeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHNqfeqgaaaHxGgebQaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeoIaaabhaaeaaaaabhbfeaaaaaHNbfeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaemHGaaH3yfeb0WaaHhGaeb5q4QGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeoIaaabxbfeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHhWaemHGaaHhGaeb4GaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaiFHhGaeaaaaaHhGaeaaaaaHhGaeaaa4QGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaa4QGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeoIaaabhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeb4WaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaH3GfebOGaaGxageaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeb5WaaHhWgeaaaaaGxagebQaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHNWgeaaaaaHxqgeqgaaaG3agebQaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaaHhWaeqgGaaHhWaem0aaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeb5WaaHNWgeaaaaaHNWgeaaaaaGNageaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaiFH3WfebLqaaH3WgeaaaaaHxWgeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaaaGhaaeaaaiQHhWaeb4WaaHhWfebLqaaHNWgeaaaaaHNW5ebPWaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHhaaeaaa4QHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaiFHhG9eaaaaaH3WfeaaaaaHNWfebLqaaH3Wfeb0qaaH3G5eaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeoIaaabhaaeaaaaaHhGaeaaa4QHhGaeaaaaaHhGaeaaaaaHhGaeaaaiFHhWaeaaaaaHhGaemHGaaHhGaeb5qaaHxWfeaaaaaHhWaeb4qaaH3G5eaaaaaGhaaeaaaaabh4aeaaaaabhaaeaaaaabhaaeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaGhaaeaaadKHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaemHGiFHhWaeb4GaaHhGaeaaaaaH3G5eaaaaaGhaaeaaaaabhaaeaaaaabhaaeoIaaaGNbfeaaaaaHhGaeaaaaaHhGaeaaaaaHhaaeaaadyHhG9eaaaaaHhGaeaaaaaHhWaeaaaaaHhaaeaaadpHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaH3G5eaaaaaGhaaeaaaaabhaaeaaaaaGxbfeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaiFHhG9eaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhG6eaaaaaGhaaeaaaaaG3bfeaaaaaHNa5eaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaiFHhWaeaaaaaHhWaeaaaaaHhWaeaaaaaHhGaeaaaiFH3G7eaaaaaHxG7eaaaaaG3ageaaaaaHNW5eqgaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhaaeaaadPHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaGNa7eaaadxHNGgeaaaaaHNW5ebOaaaHhaaeaaaaaHhGaeaaaeBHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaiFHhG9eaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhqaeqgaaaH3WgebQaaaHhWaeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaemHWaaHhGaemHaaaHhGaem0aaaHhWaeaaaaaHhGaeaaaaaHhWaeb0WaaHhWaeaaaaaHhaaeaaaaaHhGaeaaaeAHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeb5aaaHhqfeqgaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaeBHhWaeaaaaaHhWaeaaaaaHhGaeaaaiFHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeb4WaaH3afeaaaaaHhaaeb5qaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaa", cached.mapData());
    }

    @Test
    void clear() {
        SwfMapStructure structure = new SwfMapStructure();

        structure.setId(41);
        structure.setWidth(15);
        structure.setHeight(17);
        structure.setBackgroundNum(71);
        structure.setAmbianceId(6);
        structure.setMusicId(115);
        structure.setOutdoor(true);
        structure.setCapabilities(0);
        structure.setMapData("HhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHxbfeaaadyH3bfeaaaaaHhaaeoIaaaHhaaeaaadyHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeqgaaaHhGaeaaaaaGhaaeoIaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHxbfeaaadyHhbfeaaadyHxG5eaaaaabhGaeaaaaaHhG7eaaaaabhGaeaaaaaHhaaeaaaaaHha7eaaadyHhWaeaaaaaHhGaeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHhbfeaaadyHNHfeoIaaaHxG5eaaaaaH3G7eoIaaaHxG7eoIaaabhaaeaaadyHha5eoIaaaHxG7eaaaaaHhGaeaaaaaHhaaeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhaaeaaaaaHhHfeaaaaaHxHfeaaaeBHxG5eoIaiFHNa7eaaadtbhGaeaaaaaH3a5eaaaaaGNa5eaaadtHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaGhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaaHhHfeaaaaaHNHfeaaaaaHxG5eaaaaabhGaeaaaaabhGaeaaaaaHNa5eoIadyHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaGhaaeaaaaaahaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaabhGaeaaaaaH3HfeaaaaaHxG5eoIaaabhGaeaaaaaG3a6eaaadtHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhaaeaaadyGhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaaHhaaeoIadtbhaaeaaaaaGxbfeaaadLHxG5eaaaaabhGaeaaaaaHxG7eaaaaaHhGaeaaaaaHhGaemHWaaHhGaeb4aaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHNbfeaaaaaHxa5eoIadtHNa7eaaadyHhGaeaaaaaHhWaeaaaaaHxyfeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaabhaaeaaaaaHxbfeaaaaaGxa5eaaadKHhGaeaaaaaHhGaeaaaaaHhyaeb4WaaHNafeaaafCGhaaeoIaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaabhaaeaaaaaHNbfeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHNqfeqgaaaHxGgebQaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeoIaaabhaaeaaaaabhbfeaaaaaHNbfeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaemHGaaH3yfeb0WaaHhGaeb5q4QGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeoIaaabxbfeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHhWaemHGaaHhGaeb4GaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaiFHhGaeaaaaaHhGaeaaaaaHhGaeaaa4QGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaa4QGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeoIaaabhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeb4WaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaH3GfebOGaaGxageaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeb5WaaHhWgeaaaaaGxagebQaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHNWgeaaaaaHxqgeqgaaaG3agebQaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaaHhWaeqgGaaHhWaem0aaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeb5WaaHNWgeaaaaaHNWgeaaaaaGNageaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaiFH3WfebLqaaH3WgeaaaaaHxWgeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaaaGhaaeaaaiQHhWaeb4WaaHhWfebLqaaHNWgeaaaaaHNW5ebPWaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHhaaeaaa4QHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaiFHhG9eaaaaaH3WfeaaaaaHNWfebLqaaH3Wfeb0qaaH3G5eaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeoIaaabhaaeaaaaaHhGaeaaa4QHhGaeaaaaaHhGaeaaaaaHhGaeaaaiFHhWaeaaaaaHhGaemHGaaHhGaeb5qaaHxWfeaaaaaHhWaeb4qaaH3G5eaaaaaGhaaeaaaaabh4aeaaaaabhaaeaaaaabhaaeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaGhaaeaaadKHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaemHGiFHhWaeb4GaaHhGaeaaaaaH3G5eaaaaaGhaaeaaaaabhaaeaaaaabhaaeoIaaaGNbfeaaaaaHhGaeaaaaaHhGaeaaaaaHhaaeaaadyHhG9eaaaaaHhGaeaaaaaHhWaeaaaaaHhaaeaaadpHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaH3G5eaaaaaGhaaeaaaaabhaaeaaaaaGxbfeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaiFHhG9eaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhG6eaaaaaGhaaeaaaaaG3bfeaaaaaHNa5eaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaiFHhWaeaaaaaHhWaeaaaaaHhWaeaaaaaHhGaeaaaiFH3G7eaaaaaHxG7eaaaaaG3ageaaaaaHNW5eqgaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhaaeaaadPHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaGNa7eaaadxHNGgeaaaaaHNW5ebOaaaHhaaeaaaaaHhGaeaaaeBHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaiFHhG9eaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhqaeqgaaaH3WgebQaaaHhWaeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaemHWaaHhGaemHaaaHhGaem0aaaHhWaeaaaaaHhGaeaaaaaHhWaeb0WaaHhWaeaaaaaHhaaeaaaaaHhGaeaaaeAHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeb5aaaHhqfeqgaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaeBHhWaeaaaaaHhWaeaaaaaHhGaeaaaiFHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeb4WaaH3afeaaaaaHhaaeb5qaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaa");

        cache.store(structure);
        cache.clear();

        assertFalse(cache.retrieve(41).isPresent());
    }

    @Test
    void invalidVersionShouldRecreateTable() throws SQLException {
        connection.createStatement().executeUpdate("UPDATE SCHEMA_VERSION SET VERSION = 0");

        SwfMapStructure structure = new SwfMapStructure();

        structure.setId(41);
        structure.setWidth(15);
        structure.setHeight(17);
        structure.setBackgroundNum(71);
        structure.setAmbianceId(6);
        structure.setMusicId(115);
        structure.setOutdoor(true);
        structure.setCapabilities(0);
        structure.setMapData("HhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHxbfeaaadyH3bfeaaaaaHhaaeoIaaaHhaaeaaadyHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeqgaaaHhGaeaaaaaGhaaeoIaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHxbfeaaadyHhbfeaaadyHxG5eaaaaabhGaeaaaaaHhG7eaaaaabhGaeaaaaaHhaaeaaaaaHha7eaaadyHhWaeaaaaaHhGaeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHhbfeaaadyHNHfeoIaaaHxG5eaaaaaH3G7eoIaaaHxG7eoIaaabhaaeaaadyHha5eoIaaaHxG7eaaaaaHhGaeaaaaaHhaaeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhaaeaaaaaHhHfeaaaaaHxHfeaaaeBHxG5eoIaiFHNa7eaaadtbhGaeaaaaaH3a5eaaaaaGNa5eaaadtHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaGhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaaHhHfeaaaaaHNHfeaaaaaHxG5eaaaaabhGaeaaaaabhGaeaaaaaHNa5eoIadyHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaGhaaeaaaaaahaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaabhGaeaaaaaH3HfeaaaaaHxG5eoIaaabhGaeaaaaaG3a6eaaadtHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhaaeaaadyGhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaaHhaaeoIadtbhaaeaaaaaGxbfeaaadLHxG5eaaaaabhGaeaaaaaHxG7eaaaaaHhGaeaaaaaHhGaemHWaaHhGaeb4aaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHNbfeaaaaaHxa5eoIadtHNa7eaaadyHhGaeaaaaaHhWaeaaaaaHxyfeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaabhaaeaaaaaHxbfeaaaaaGxa5eaaadKHhGaeaaaaaHhGaeaaaaaHhyaeb4WaaHNafeaaafCGhaaeoIaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaabhaaeaaaaaHNbfeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHNqfeqgaaaHxGgebQaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeoIaaabhaaeaaaaabhbfeaaaaaHNbfeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaemHGaaH3yfeb0WaaHhGaeb5q4QGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeoIaaabxbfeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHhWaemHGaaHhGaeb4GaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaiFHhGaeaaaaaHhGaeaaaaaHhGaeaaa4QGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaa4QGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeoIaaabhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeb4WaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaH3GfebOGaaGxageaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeb5WaaHhWgeaaaaaGxagebQaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHNWgeaaaaaHxqgeqgaaaG3agebQaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaaHhWaeqgGaaHhWaem0aaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeb5WaaHNWgeaaaaaHNWgeaaaaaGNageaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaiFH3WfebLqaaH3WgeaaaaaHxWgeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaaaGhaaeaaaiQHhWaeb4WaaHhWfebLqaaHNWgeaaaaaHNW5ebPWaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHhaaeaaa4QHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaiFHhG9eaaaaaH3WfeaaaaaHNWfebLqaaH3Wfeb0qaaH3G5eaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeoIaaabhaaeaaaaaHhGaeaaa4QHhGaeaaaaaHhGaeaaaaaHhGaeaaaiFHhWaeaaaaaHhGaemHGaaHhGaeb5qaaHxWfeaaaaaHhWaeb4qaaH3G5eaaaaaGhaaeaaaaabh4aeaaaaabhaaeaaaaabhaaeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaGhaaeaaadKHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaemHGiFHhWaeb4GaaHhGaeaaaaaH3G5eaaaaaGhaaeaaaaabhaaeaaaaabhaaeoIaaaGNbfeaaaaaHhGaeaaaaaHhGaeaaaaaHhaaeaaadyHhG9eaaaaaHhGaeaaaaaHhWaeaaaaaHhaaeaaadpHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaH3G5eaaaaaGhaaeaaaaabhaaeaaaaaGxbfeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaiFHhG9eaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhG6eaaaaaGhaaeaaaaaG3bfeaaaaaHNa5eaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaiFHhWaeaaaaaHhWaeaaaaaHhWaeaaaaaHhGaeaaaiFH3G7eaaaaaHxG7eaaaaaG3ageaaaaaHNW5eqgaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhaaeaaadPHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaGNa7eaaadxHNGgeaaaaaHNW5ebOaaaHhaaeaaaaaHhGaeaaaeBHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaiFHhG9eaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhqaeqgaaaH3WgebQaaaHhWaeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaemHWaaHhGaemHaaaHhGaem0aaaHhWaeaaaaaHhGaeaaaaaHhWaeb0WaaHhWaeaaaaaHhaaeaaaaaHhGaeaaaeAHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeb5aaaHhqfeqgaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaeBHhWaeaaaaaHhWaeaaaaaHhGaeaaaiFHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeb4WaaH3afeaaaaaHhaaeb5qaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaa");

        cache.store(structure);

        SqlMapStructureCache newCache = new SqlMapStructureCache(connection);

        assertFalse(newCache.retrieve(41).isPresent());
        assertTrue(connection.createStatement().executeQuery("SELECT `VERSION` FROM  `SCHEMA_VERSION` WHERE `VERSION` = 1").next());
    }

    @Test
    void createBySqliteFile() throws SQLException {
        File sqliteFile = new File("tmp/map_cache.sqlite");

        if (sqliteFile.exists()) {
            sqliteFile.delete();
        }

        if (sqliteFile.getParentFile().exists()) {
            sqliteFile.getParentFile().delete();
        }

        SqlMapStructureCache fileCache = SqlMapStructureCache.createBySqliteFile(sqliteFile.getAbsolutePath());

        assertTrue(sqliteFile.getParentFile().exists());
        assertTrue(sqliteFile.exists());

        SwfMapStructure structure = new SwfMapStructure();

        structure.setId(41);
        structure.setWidth(15);
        structure.setHeight(17);
        structure.setBackgroundNum(71);
        structure.setAmbianceId(6);
        structure.setMusicId(115);
        structure.setOutdoor(true);
        structure.setCapabilities(0);
        structure.setMapData("HhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHxbfeaaadyH3bfeaaaaaHhaaeoIaaaHhaaeaaadyHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeqgaaaHhGaeaaaaaGhaaeoIaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHxbfeaaadyHhbfeaaadyHxG5eaaaaabhGaeaaaaaHhG7eaaaaabhGaeaaaaaHhaaeaaaaaHha7eaaadyHhWaeaaaaaHhGaeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHhbfeaaadyHNHfeoIaaaHxG5eaaaaaH3G7eoIaaaHxG7eoIaaabhaaeaaadyHha5eoIaaaHxG7eaaaaaHhGaeaaaaaHhaaeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhaaeaaaaaHhHfeaaaaaHxHfeaaaeBHxG5eoIaiFHNa7eaaadtbhGaeaaaaaH3a5eaaaaaGNa5eaaadtHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaGhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaaHhHfeaaaaaHNHfeaaaaaHxG5eaaaaabhGaeaaaaabhGaeaaaaaHNa5eoIadyHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaGhaaeaaaaaahaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaabhGaeaaaaaH3HfeaaaaaHxG5eoIaaabhGaeaaaaaG3a6eaaadtHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhaaeaaadyGhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaaHhaaeoIadtbhaaeaaaaaGxbfeaaadLHxG5eaaaaabhGaeaaaaaHxG7eaaaaaHhGaeaaaaaHhGaemHWaaHhGaeb4aaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHNbfeaaaaaHxa5eoIadtHNa7eaaadyHhGaeaaaaaHhWaeaaaaaHxyfeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaabhaaeaaaaaHxbfeaaaaaGxa5eaaadKHhGaeaaaaaHhGaeaaaaaHhyaeb4WaaHNafeaaafCGhaaeoIaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaabhaaeaaaaaHNbfeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHNqfeqgaaaHxGgebQaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeoIaaabhaaeaaaaabhbfeaaaaaHNbfeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaemHGaaH3yfeb0WaaHhGaeb5q4QGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeoIaaabxbfeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHhWaemHGaaHhGaeb4GaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhaaeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaiFHhGaeaaaaaHhGaeaaaaaHhGaeaaa4QGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaa4QGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeoIaaabhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeb4WaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaH3GfebOGaaGxageaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaabhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeb5WaaHhWgeaaaaaGxagebQaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaaHhaaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHNWgeaaaaaHxqgeqgaaaG3agebQaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaabhGaeaaaaaHhWaeqgGaaHhWaem0aaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeb5WaaHNWgeaaaaaHNWgeaaaaaGNageaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaeaaaiFH3WfebLqaaH3WgeaaaaaHxWgeaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaaaGhaaeaaaiQHhWaeb4WaaHhWfebLqaaHNWgeaaaaaHNW5ebPWaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeaaaaaHhaaeaaa4QHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaiFHhG9eaaaaaH3WfeaaaaaHNWfebLqaaH3Wfeb0qaaH3G5eaaaaaGhaaeaaaaabhaaeaaaaabhaaeaaaaabhaaeoIaaabhaaeaaaaaHhGaeaaa4QHhGaeaaaaaHhGaeaaaaaHhGaeaaaiFHhWaeaaaaaHhGaemHGaaHhGaeb5qaaHxWfeaaaaaHhWaeb4qaaH3G5eaaaaaGhaaeaaaaabh4aeaaaaabhaaeaaaaabhaaeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaGhaaeaaadKHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhGaemHGiFHhWaeb4GaaHhGaeaaaaaH3G5eaaaaaGhaaeaaaaabhaaeaaaaabhaaeoIaaaGNbfeaaaaaHhGaeaaaaaHhGaeaaaaaHhaaeaaadyHhG9eaaaaaHhGaeaaaaaHhWaeaaaaaHhaaeaaadpHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaH3G5eaaaaaGhaaeaaaaabhaaeaaaaaGxbfeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaiFHhG9eaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhG6eaaaaaGhaaeaaaaaG3bfeaaaaaHNa5eaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaiFHhWaeaaaaaHhWaeaaaaaHhWaeaaaaaHhGaeaaaiFH3G7eaaaaaHxG7eaaaaaG3ageaaaaaHNW5eqgaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhaaeaaadPHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaGNa7eaaadxHNGgeaaaaaHNW5ebOaaaHhaaeaaaaaHhGaeaaaeBHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaiFHhG9eaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaaaHhGaeaaaaaHhqaeqgaaaH3WgebQaaaHhWaeaaaaaHhaaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaemHWaaHhGaemHaaaHhGaem0aaaHhWaeaaaaaHhGaeaaaaaHhWaeb0WaaHhWaeaaaaaHhaaeaaaaaHhGaeaaaeAHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhGaeaaaaaHhWaeb5aaaHhqfeqgaaaHhGaeaaaaaHhGaeaaaaaHhWaeaaaeBHhWaeaaaaaHhWaeaaaaaHhGaeaaaiFHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeb4WaaH3afeaaaaaHhaaeb5qaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaaHhaaeaaaaa");

        fileCache.store(structure);
        assertEquals(structure.mapData(), fileCache.retrieve(41).get().mapData());

        sqliteFile.delete();
    }
}
